<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.happy.day.resources.mappers.QuestionMapper">

	<select id="selectQuestionList" parameterType="questionDto"
		resultType="questionListDto">
		SELECT   a.question_seq,
		         a.question_title,
		         b.user_name  AS author_name,
		         c.author_seq AS category_author_seq,
		         count(CASE WHEN d.question_seq=a.question_seq THEN 1 end) AS recommand_cnt
		FROM     question AS a
		JOIN     user    AS b
		ON       a.author_seq = b.user_seq
		AND      a.category_seq = #{categorySeq}
		JOIN     category AS c
		ON       a.category_seq = c.category_seq
		JOIN     recommand AS d
		group BY a.question_seq;
	</select>

	<select id="selectQuestionInfoList" parameterType="questionDto"
		resultType="questionDto">
		SELECT *
		FROM  question
		WHERE CATEGORY_SEQ = #{categorySeq}
	</select>

	<select id="selectQuestionInfo" parameterType="questionDto"
		resultType="questionDto">
		SELECT *
		FROM  question
		WHERE QUESTION_SEQ = #{questionSeq} 
	</select>

	<insert id="insertQuestion" parameterType="questionDto"
		useGeneratedKeys="true" keyProperty="questionSeq">
		INSERT INTO question
					(QUESTION_TITLE,
					QUESTION_TYPE,
					QUESTION_ANSWER,
					AUTHOR_SEQ,
					CATEGORY_SEQ)
		VALUES 		(#{questionTitle},
					#{questionType},
					#{questionAnswer},
					#{authorSeq},
					#{categorySeq})
	</insert>
	<update id="updateQuestion" parameterType="questionDto">
		UPDATE question
		SET    QUESTION_TITLE = #{questionTitle},
		 	   QUESTION_TYPE = #{questionType},
			   QUESTION_ANSWER = #{questionAnswer}
		WHERE  QUESTION_SEQ = #{questionSeq}
	</update>

</mapper>